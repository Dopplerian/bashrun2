#!/bin/bash
BASHRUN_PREFIX=`which bashrun 2> /dev/null`
BASHRUN_PREFIX=${BASHRUN_PREFIX/\/bin\/bashrun/}
BASHRUN_SHARE="$BASHRUN_PREFIX/share/bashrun-engine"

. $BASHRUN_SHARE/frontend

if [ -f "$BASHRUN_REGISTRY" ]; then
    
    # get window id and current mode of the oldest instance
    [[ "$(cat $BASHRUN_REGISTRY | head -1)" =~ ([0-9]+):(.+) ]]
    
    wid="${BASH_REMATCH[1]}"
    mode="${BASH_REMATCH[2]}"
    
    # set window id and mode
    bashrun.window.id "$wid"
    modes.seek "$mode"

    bashrun.window.toggle
else
    BASHRUN=1 urxvt -name bashrun -title bashrun &
fi


