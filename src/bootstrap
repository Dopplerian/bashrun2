# -*- shell-script -*-

function §bootstrap {

    §bootstrap.directories
    §bootstrap.bashrc
}

function §bootstrap.directories {
    
    # create data and cache directories
    local dir
    for dir in DATA CACHE; do

	dir="BASHRUN_${dir}_HOME"
	dir=${!dir}
	
	if [[ ! -d $dir && ! -L $dir ]]; then
	    install -v -d -m 700 $dir
	fi
    done
}

function §bootstrap.bashrc {
    
    local comment="# Required for bashrun, see bashrun(1)"
    if [[ -f $HOME/.bashrc ]]; then
	if ! grep 'BASHRUN -eq 1' $HOME/.bashrc &>/dev/null; then
	    printf "\n$comment\n[[ BASHRUN -eq 1 ]] && . $BASHRUN_SHARE/bashrc\n" >> $HOME/.bashrc
	    §message "Information" \
		"The following line has been appended to your ~/.bashrc:

                 [[ BASHRUN -eq 1 ]] && . $BASHRUN_SHARE/bashrc

                 This line is required to initialize the bashrun engine. 
                 See bashrun(1) for details." 2>/dev/null

	fi
    else
	echo "
[[ # Check for an interactive session
[ -z "$PS1" ] && return

$comment
[[ BASHRUN -eq 1 ]] && . $BASHRUN_SHARE/bashrc
" > $HOME/.bashrc
    fi
}

§bootstrap